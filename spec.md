# FitBet ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

**FitBet** ‚Äî Telegram‚Äë–±–æ—Ç –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Ñ–∏—Ç–Ω–µ—Å‚Äë—á–µ–ª–ª–µ–Ω–¥–∂–µ–π —Å –¥–µ–Ω–µ–∂–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º–∏ —á–µ–∫‚Äë–∏–Ω–∞–º–∏ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –±–∞–Ω–∫–∞.

**–ö–∞–Ω–∞–ª—ã –æ–±—â–µ–Ω–∏—è:**
- **–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞, –Ω–∞–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –æ–±—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
- **–õ–∏—á–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ —Å –±–æ—Ç–æ–º** ‚Äî –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ Bank Holder, —á–µ–∫‚Äë–∏–Ω—ã, –æ–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

**–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** —Ä—É—Å—Å–∫–∏–π, —Å–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è Markdown.

---

## 2. –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞

- **–°–æ–∑–¥–∞—Ç–µ–ª—å —á–µ–ª–ª–µ–Ω–¥–∂–∞** (creator) ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–≤–∞–ª `/create` –≤ –≥—Ä—É–ø–ø–µ. –¢–æ–ª—å–∫–æ –æ–Ω –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ `/bankholder`.
- **–£—á–∞—Å—Ç–Ω–∏–∫** ‚Äî –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—Ä–æ—à–µ–¥—à–∏–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∏ –æ–ø–ª–∞—Ç—É.
- **Bank Holder** ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã.
- **–ê–¥–º–∏–Ω** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `ADMIN_TELEGRAM_ID`. –ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/clear_db`.

---

## 3. –ö–æ–º–∞–Ω–¥—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 3.1. –ö–æ–º–∞–Ω–¥—ã –≤ –ª–∏—á–∫–µ (all_private_chats)
- `/start` ‚Äî –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∏–ª–∏ —á–µ–∫‚Äë–∏–Ω.
- `/status` ‚Äî —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–∏—è –≤–æ –≤—Å–µ—Ö —á–µ–ª–ª–µ–Ω–¥–∂–∞—Ö.
- `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞.
- `/clear_db` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –ë–î (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω).

### 3.2. –ö–æ–º–∞–Ω–¥—ã –≤ –≥—Ä—É–ø–ø–∞—Ö (all_group_chats / all_chat_administrators)
- `/create` ‚Äî —Å–æ–∑–¥–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂.
- `/bankholder` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ Bank Holder.
- `/status` ‚Äî —Å—Ç–∞—Ç—É—Å —á–µ–ª–ª–µ–Ω–¥–∂–∞ –≤ –≥—Ä—É–ø–ø–µ.
- `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞.

---

## 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env + –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)

- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram‚Äë–±–æ—Ç–∞ (**–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**).
- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `file:./data/fitbet.db`).
- `OPENROUTER_API_KEY` ‚Äî –∫–ª—é—á OpenRouter (–¥–ª—è LLM‚Äë–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π).
- `SENTRY_DSN` ‚Äî DSN –¥–ª—è Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- `NODE_ENV` ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`development` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
- `ADMIN_TELEGRAM_ID` ‚Äî Telegram ID –∞–¥–º–∏–Ω–∞ –¥–ª—è `/clear_db`.
- `CHALLENGE_DURATION_UNIT` ‚Äî –µ–¥–∏–Ω–∏—Ü–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (`months|hours`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `months`). hours - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É –±–æ—Ç–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∂–¥–∞—Ç—å –ø–æ 14 –¥–Ω–µ–π –¥–ª—è –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ —á–µ–∫–∏–Ω–∞. –í –ø—Ä–æ–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
- `CHECKIN_PERIOD_DAYS` ‚Äî –ø–µ—Ä–∏–æ–¥ –º–µ–∂–¥—É —á–µ–∫-–∏–Ω–∞–º–∏ –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14).
- `CHECKIN_PERIOD_MINUTES` ‚Äî –ø–µ—Ä–∏–æ–¥ –º–µ–∂–¥—É —á–µ–∫-–∏–Ω–∞–º–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö. –ï—Å–ª–∏ > 0, –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ `CHECKIN_PERIOD_DAYS`.
  - –ü—Ä–∏ `CHECKIN_PERIOD_MINUTES < 60` scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –∫–æ–¥–µ:**
- `photosDirectory` = `data/photos`.
- `checkinWindowHours` = 48 —á–∞—Å–æ–≤.
- `reminderHoursBeforeClose` = 12 —á–∞—Å–æ–≤.
- `checkinPeriodDays` = 14 –¥–Ω–µ–π (–µ—Å–ª–∏ `checkinPeriodMinutes = 0`).
- `checkinPeriodMinutes` = 0 (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–∞).
- `defaultDisciplineThreshold` = 0.8.
- `defaultMaxSkips` = 2.

---

## 5. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (SQLite —á–µ—Ä–µ–∑ Drizzle)

### 5.1. challenges
- `id`
- `chat_id`, `chat_title`, `creator_id`
- `duration_months`, `stake_amount`, `discipline_threshold`, `max_skips`
- `bank_holder_id`, `bank_holder_username`
- `status` ‚àà `draft | pending_payments | active | completed | cancelled`
- `created_at`, `started_at`, `ends_at`

### 5.2. participants
- `id`, `challenge_id`, `user_id`, `username`, `first_name`
- `track` ‚àà `cut | bulk`
- `start_weight`, `start_waist`, `height`
- `start_photo_front_id`, `start_photo_left_id`, `start_photo_right_id`, `start_photo_back_id`
- `total_checkins`, `completed_checkins`, `skipped_checkins`
- `pending_checkin_window_id`, `pending_checkin_requested_at`
- `status` ‚àà `onboarding | pending_payment | payment_marked | active | dropped | disqualified | completed`
- `joined_at`, `onboarding_completed_at`

### 5.3. goals
- `participant_id`
- `target_weight`, `target_waist`
- `is_validated`, `validation_result`, `validation_feedback`, `validated_at`
- `created_at`, `updated_at`

### 5.4. checkin_windows
- `challenge_id`, `window_number`
- `opens_at`, `closes_at`, `reminder_sent_at`
- `status` ‚àà `scheduled | open | closed`

### 5.5. checkins
- `participant_id`, `window_id`
- `weight`, `waist`
- `photo_front_id`, `photo_left_id`, `photo_right_id`, `photo_back_id`
- `submitted_at`
- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:** `(participant_id, window_id)`

### 5.6. commitment_templates
- `name`, `description`, `category` (`nutrition|exercise|lifestyle`)
- `is_active`

### 5.7. participant_commitments
- `participant_id`, `template_id`, `created_at`

### 5.8. payments
- `participant_id`
- `status` ‚àà `pending | marked_paid | confirmed | refunded`
- `marked_paid_at`, `confirmed_at`, `confirmed_by`

### 5.9. bank_holder_elections
- `challenge_id` (unique)
- `initiated_by`
- `status` ‚àà `in_progress | completed | cancelled`
- `created_at`, `completed_at`

### 5.10. bank_holder_votes
- `election_id`, `voter_id`, `voted_for_id`, `voted_at`

### 5.11. checkin_recommendations
- `checkin_id`, `participant_id`
- `progress_assessment`, `body_composition_notes`, `nutrition_advice`, `training_advice`, `motivational_message`
- `warning_flags` (JSON —Å—Ç—Ä–æ–∫–∞), `llm_model`, `tokens_used`, `processing_time_ms`
- `created_at`

---

## 6. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —á–µ–ª–ª–µ–Ω–¥–∂–∞

### 6.1. –°–æ–∑–¥–∞–Ω–∏–µ
1. –í –≥—Ä—É–ø–ø–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `/create`.
2. –ë–æ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª 7.2).
3. –°–æ–∑–¥–∞—ë—Ç—Å—è —á–µ–ª–ª–µ–Ω–¥–∂ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `draft`.
4. –í –≥—Ä—É–ø–ø–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π **¬´üôã –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å¬ª**.

### 6.2. –ù–∞–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞–∂–∏–º–∞—é—Ç –∫–Ω–æ–ø–∫—É **¬´–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å¬ª** ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `onboarding`.
- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ –ª–∏—á–∫–µ.

### 6.3. –í—ã–±–æ—Ä Bank Holder
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `/bankholder` (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å). –î–µ—Ç–∞–ª–∏ ‚Äî —Ä–∞–∑–¥–µ–ª 7.3.
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ Bank Holder —Å—Ç–∞—Ç—É—Å —á–µ–ª–ª–µ–Ω–¥–∂–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `pending_payments`.

### 6.4. –û–ø–ª–∞—Ç—ã
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –æ–ø–ª–∞—Ç—É –≤ –ª–∏—á–∫–µ –∫–Ω–æ–ø–∫–æ–π **¬´üí≥ –Ø –æ–ø–ª–∞—Ç–∏–ª¬ª**.
- Bank Holder –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã –∫–Ω–æ–ø–∫–æ–π **¬´‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª**.
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö –æ–ø–ª–∞—Ç —á–µ–ª–ª–µ–Ω–¥–∂ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è (`active`).

### 6.5. –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–¥–∏—è
- –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —á–µ–∫‚Äë–∏–Ω—ã.
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞.

### 6.6. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –ü–æ `ends_at` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç.
- –°—Ç–∞—Ç—É—Å —á–µ–ª–ª–µ–Ω–¥–∂–∞ ‚Üí `completed`.

---

## 7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –∫–æ–º–∞–Ω–¥—ã

### 7.1. `/start`

#### –í –ª–∏—á–∫–µ
–ë–æ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. **–ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —á–µ–∫‚Äë–∏–Ω –≤ —Å–µ—Å—Å–∏–∏** ‚Üí —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç —á–µ–∫‚Äë–∏–Ω.
2. **–û–∂–∏–¥–∞—é—â–∏–π —á–µ–∫‚Äë–∏–Ω –≤ –ë–î (pending)** ‚Üí –µ—Å–ª–∏ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ –∏ —á–µ–∫‚Äë–∏–Ω –Ω–µ —Å–¥–∞–Ω, –∑–∞–ø—É—Å–∫–∞–µ—Ç —á–µ–∫‚Äë–∏–Ω.
3. **–û–Ω–±–æ—Ä–¥–∏–Ω–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ** ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥.
4. **–£–∂–µ –∞–∫—Ç–∏–≤–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ** ‚Üí —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ —É—á–∞—Å—Ç–∏–µ —É–∂–µ –µ—Å—Ç—å, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç `/status`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —É—á–∞—Å—Ç–∏–µ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º —á–µ–ª–µ–Ω–¥–∂–µ. –¢–æ –µ—Å—Ç—å –µ—Å–ª–∏ –≤ –æ–¥–Ω–æ–π –∏–∑ –≥—Ä—É–ø–ø –æ–Ω —É–∂–µ –≤—Å—Ç—É–ø–∏–ª –≤ —á–µ–ª–µ–Ω–¥–∂, —Ç–æ –ø–æ–∫–∞ —á–µ–ª–µ–Ω–¥–∂ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è  - –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –≤—Å—Ç—É–ø–∞—Ç—å –≤ –¥—Ä—É–≥–∏–µ —á–µ–ª–µ–Ω–¥–∂–∏ –≤ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø–∞—Ö.
5. –ò–Ω–∞—á–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.

#### –í –≥—Ä—É–ø–ø–µ
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –±–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ —á–∞—Ç–µ, –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç `/create` –∏ `/help`.

---

### 7.2. `/create` (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∞)

**–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–∑–≤–∞–Ω–∞ –≤ –ª–∏—á–∫–µ:** –±–æ—Ç —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–µ.

**–ï—Å–ª–∏ –≤ —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å —Ç–µ–∫—É—â–∏–π —á–µ–ª–ª–µ–Ω–¥–∂:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ–ª–ª–µ–Ω–¥–∂–∞.
- –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `draft` –∏–ª–∏ `pending_payments` –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ —É—á–∞—Å—Ç–Ω–∏–∫ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É **¬´üôã –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å¬ª**.

**–ï—Å–ª–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∞ –Ω–µ—Ç ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –∫–Ω–æ–ø–∫–∏ `6` –∏–ª–∏ `12` (–≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö `CHALLENGE_DURATION_UNIT`).
2. **–°—Ç–∞–≤–∫–∞:** –≤–≤–æ–¥ —á–∏—Å–ª–∞ –≤ —Ä—É–±–ª—è—Ö (float > 0).
3. **–ü–æ—Ä–æ–≥ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã:** –∫–Ω–æ–ø–∫–∏ 70/80/90.
4. **–ú–∞–∫—Å. –ø—Ä–æ–ø—É—Å–∫–æ–≤:** –∫–Ω–æ–ø–∫–∏ 1/2/3.
5. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∞ (`draft`).
6. –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–æ–π **¬´üôã –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å¬ª**.

**–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –≤ –¥–∏–∞–ª–æ–≥–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.**

---

### 7.3. `/bankholder` (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∞)

–£—Å–ª–æ–≤–∏—è –∑–∞–ø—É—Å–∫–∞:
- –ß–µ–ª–ª–µ–Ω–¥–∂ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω.
- –ö–æ–º–∞–Ω–¥—É –≤—ã–∑—ã–≤–∞–µ—Ç **—Å–æ–∑–¥–∞—Ç–µ–ª—å —á–µ–ª–µ–Ω–¥–∂–∞**.
- Bank Holder –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–Ω.
- –ï—Å—Ç—å –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥.
- –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
1. –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤—ã–±–æ—Ä–æ–≤ `bank_holder_elections` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `in_progress`.
2. –í –≥—Ä—É–ø–ø–µ –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –Ω–∞—á–∞–ª–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 24 —á–∞—Å–∞).
3. –ö–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (–Ω–µ –≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–µ) –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–ª–∏—á–Ω–æ–µ** —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏‚Äë–∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å—Ç–∞—Ç—É—Å–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞, —Ç–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞, –µ—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ bank holder –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, —Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å.
4. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤ –∏–ª–∏ –ø–æ —Ç–∞–π–º–∞—É—Ç—É –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—å.

**–¢–∞–π–º–∞—É—Ç:** 24 —á–∞—Å–∞. –ï—Å–ª–∏ –Ω–µ –≤—Å–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ –∏–º–µ—é—â–∏–º—Å—è –≥–æ–ª–æ—Å–∞–º.

**–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:**
- –ü–æ–±–µ–∂–¥–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º –≥–æ–ª–æ—Å–æ–≤.
- –ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ ‚Äî –∫–∞–Ω–¥–∏–¥–∞—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º `user_id`.
- –ï—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å = —Å–æ–∑–¥–∞—Ç–µ–ª—å (–µ—Å–ª–∏ –æ–Ω —Å—Ä–µ–¥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤), –∏–Ω–∞—á–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `user_id`.

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `bank_holder_id`.
- –°—Ç–∞—Ç—É—Å —á–µ–ª–ª–µ–Ω–¥–∂–∞ ‚Üí `pending_payments`.
- –í –≥—Ä—É–ø–ø—É –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- Bank Holder –ø–æ–ª—É—á–∞–µ—Ç –ª–∏—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
- –í—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending_payment` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ **¬´üí≥ –Ø –æ–ø–ª–∞—Ç–∏–ª¬ª**.

---

### 7.4. `/status`

#### –í –ª–∏—á–∫–µ
–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—á–∞—Å—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–∏—è (onboarding, pending_payment, payment_marked, active, dropped, disqualified, completed).
- –î–∞—Ç—ã —Å—Ç–∞—Ä—Ç–∞/—Ñ–∏–Ω–∏—à–∞ —á–µ–ª–ª–µ–Ω–¥–∂–∞ (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã).
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö.
- –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ü–µ–ª–µ–≤—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ü–µ–ª—å).
- –í–æ–∑–º–æ–∂–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ù–∞–ø–∏—à–∏—Ç–µ /start, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª).
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–Ω–æ–º–æ–º–µ–Ω—Ç–Ω–æ –º–æ–∂–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —á–µ–ª–µ–Ω–¥–∂.

#### –í –≥—Ä—É–ø–ø–µ
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å —á–µ–ª–ª–µ–Ω–¥–∂–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ —á–µ–∫‚Äë–∏–Ω–∞–º–∏.

---

### 7.5. `/help`

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–ª–∏–Ω–Ω–æ–µ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞, —à–∞–≥–æ–≤, —Ñ–æ—Ä–º—É–ª—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.


---

### 7.6. `/clear_db` (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)

**–î–æ—Å—Ç—É–ø:** —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ –∏ —Ç–æ–ª—å–∫–æ –¥–ª—è `ADMIN_TELEGRAM_ID`.

- –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏ **¬´–î–∞/–ù–µ—Ç¬ª**.
- –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –ë–î (–≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã) –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç —à–∞–±–ª–æ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.

---

## 8. –ò–Ω–ª–∞–π–Ω‚Äë–∫–Ω–æ–ø–∫–∏ –∏ callback‚Äë—Å—Ü–µ–Ω–∞—Ä–∏–∏

### 8.1. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- **–ö–Ω–æ–ø–∫–∞:** `üôã –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å`
- **Callback:** `join_{challengeId}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ–ª–ª–µ–Ω–¥–∂–∞ (`draft` –∏–ª–∏ `pending_payments`).
- –ï—Å–ª–∏ —É–∂–µ —É—á–∞—Å—Ç–Ω–∏–∫:
  - `onboarding` ‚Üí –≤ –ª–∏—á–∫—É —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ù–∞–ø–∏—à–∏—Ç–µ /start¬ª.
  - `dropped` ‚Üí –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (—Å–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö).
  - –∏–Ω–∞—á–µ ‚Üí ¬´–í—ã —É–∂–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ¬ª.
- –ò–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫ `onboarding`.
- –í –≥—Ä—É–ø–ø–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—á—ë—Ç—á–∏–∫ –≤ –∫–Ω–æ–ø–∫–µ (`üôã –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å (N)`).
- –í –ª–∏—á–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å `/start`.

---

### 8.2. –û–ø–ª–∞—Ç–∞
- **–ö–Ω–æ–ø–∫–∞:** `üí≥ –Ø –æ–ø–ª–∞—Ç–∏–ª`
- **Callback:** `paid_{participantId}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –†–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫—É –∏ —Ç–æ–ª—å–∫–æ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending_payment`.
- –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–µ—Å–ª–∏ –Ω–µ—Ç), –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `marked_paid`.
- –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Üí `payment_marked`.
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ = Bank Holder ‚Üí –∞–≤—Ç–æ‚Äë–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å `active`.
- –ò–Ω–∞—á–µ Bank Holder –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.

---

### 8.3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
- **–ö–Ω–æ–ø–∫–∞:** `‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É`
- **Callback:** `confirm_{participantId}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –¢–æ–ª—å–∫–æ Bank Holder –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å.
- –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `payment_marked`.
- –ü–ª–∞—Ç—ë–∂ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ `confirmed`, —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Üí `active`.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫—É –∏ –≥—Ä—É–ø–ø–µ.
- –ï—Å–ª–∏ –≤—Å–µ –æ–ø–ª–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã ‚Üí —á–µ–ª–ª–µ–Ω–¥–∂ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.

---

### 8.4. –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ Bank Holder
- **–ö–Ω–æ–ø–∫–∞:** –∏–º—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
- **Callback:** `vote_{electionId}_{candidateUserId}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ì–æ–ª–æ—Å –º–æ–∂–Ω–æ –¥–∞—Ç—å 1 —Ä–∞–∑.
- –ö–∞–Ω–¥–∏–¥–∞—Ç –∏ –≥–æ–ª–æ—Å—É—é—â–∏–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ (–Ω–µ `onboarding`).
- –ü–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è (¬´–í–∞—à –≥–æ–ª–æ—Å —É—á—Ç—ë–Ω¬ª).

---

### 8.5. –ß–µ–∫‚Äë–∏–Ω
- **–ö–Ω–æ–ø–∫–∞:** `üìã –°–¥–µ–ª–∞—Ç—å —á–µ–∫-–∏–Ω`
- **Callback:** `checkin_{windowId}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞: –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ –∏ —É—á–∞—Å—Ç–Ω–∏–∫ `active`.
- –ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî –±–æ—Ç –æ—Ç–º–µ—á–∞–µ—Ç `pending_checkin_window_id` –∏ –ø—Ä–æ—Å–∏—Ç –ø–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–∫—É —Å `/start`.

---

### 8.6. –û—á–∏—Å—Ç–∫–∞ –ë–î
- **–ö–Ω–æ–ø–∫–∏:** `clear_db_yes`, `clear_db_no`

---

## 9. –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–ª–∏—á–∫–∞)

**–¢—Ä–∏–≥–≥–µ—Ä:** `/start` (–µ—Å–ª–∏ –µ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `onboarding`).

### 9.1. –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
–ï—Å–ª–∏ —É —É—á–∞—Å—Ç–Ω–∏–∫–∞ —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ (—Ç—Ä–µ–∫/–º–µ—Ç—Ä–∏–∫–∏/—Ñ–æ—Ç–æ), –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç:
- **¬´‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª** ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.
- **¬´üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ¬ª** ‚Äî –æ—á–∏—â–∞–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ü–µ–ª–∏ –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏—Ç **–æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤–º–µ—Å—Ç–æ –∫–Ω–æ–ø–∫–∏, –±–æ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç—Ç–æ –∫–∞–∫ ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.

### 9.2. –®–∞–≥–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
1. **–í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞:** `–ü–æ—Ö—É–¥–µ—Ç—å` –∏–ª–∏ `–ù–∞–±—Ä–∞—Ç—å` (–∫–Ω–æ–ø–∫–∏).
2. **–í–µ—Å (–∫–≥):** –≤–≤–æ–¥ —á–∏—Å–ª–æ–º 30‚Äì150.
3. **–¢–∞–ª–∏—è (—Å–º):** –≤–≤–æ–¥ 40‚Äì150.
4. **–†–æ—Å—Ç (—Å–º):** –≤–≤–æ–¥ 140‚Äì220.
5. **–§–æ—Ç–æ 1/4 (–∞–Ω—Ñ–∞—Å)** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ.
6. **–§–æ—Ç–æ 2/4 (–ø—Ä–æ—Ñ–∏–ª—å —Å–ª–µ–≤–∞)** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ.
7. **–§–æ—Ç–æ 3/4 (–ø—Ä–æ—Ñ–∏–ª—å —Å–ø—Ä–∞–≤–∞)** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ.
8. **–§–æ—Ç–æ 4/4 (—Å–æ —Å–ø–∏–Ω—ã)** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ.

–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ: `data/photos/{participantId}/start/{front|left|right|back}.jpg`.

### 9.3. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–∏
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ü–µ–ª–∏** (BMI=22, WHtR=0.45, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ–º–ø—ã).
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ—ë.
- –ü—Ä–æ–≤–µ—Ä–∫–∏:
  - –î–ª—è `–ü–æ—Ö—É–¥–µ—Ç—å` —Ü–µ–ª–µ–≤–æ–π –≤–µ—Å/—Ç–∞–ª–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–∏—Ö.
  - –î–ª—è `–ù–∞–±—Ä–∞—Ç—å` **–Ω–µ—Ç —Å—Ç—Ä–æ–≥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏** –¥–ª—è —Ç–∞–ª–∏–∏ (–≤–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ).

### 9.4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–∏ (LLM)
- –ï—Å–ª–∏ `OPENROUTER_API_KEY` –µ—Å—Ç—å ‚Äî —Ü–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ LLM (google/gemini-3-flash-preview).
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: `realistic`, `too_aggressive`, `too_easy`.
- –ü—Ä–∏ `too_aggressive/too_easy` –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç—å —Ç–µ–∫—É—â—É—é —Ü–µ–ª—å.
- –ú–∞–∫—Å–∏–º—É–º 3 –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ —Ü–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ.
- –ï—Å–ª–∏ LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî —Ü–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### 9.5. –û–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç 2‚Äì3 –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤.
- –í–≤–æ–¥–∏—Ç –Ω–æ–º–µ—Ä–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª/–∑–∞–ø—è—Ç—É—é.

### 9.6. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Üí `pending_payment`.
- –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –æ–ø–ª–∞—Ç—ã `payments`.
- –í –ª–∏—á–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ **¬´üí≥ –Ø –æ–ø–ª–∞—Ç–∏–ª¬ª**.

### 9.7. –¢–∞–π–º–∞—É—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
–ß–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- –ï—Å–ª–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ `dropped`.
- –í –≥—Ä—É–ø–ø–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
- –í –ª–∏—á–∫—É ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —á–µ–ª–µ–Ω–¥–∂—É. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —á–µ–ª–µ–Ω–¥–∂—É, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª (–≤—Å–µ –æ–ø–ª–∞—Ç–∏–ª–∏ –∏ –ø–æ—à–µ–ª –æ—Ç—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏) –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.

---

## 10. –û–ø–ª–∞—Ç—ã –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è

1. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ Bank Holder —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã.
2. –ù–∞–∂–∞—Ç–∏–µ **¬´–Ø –æ–ø–ª–∞—Ç–∏–ª¬ª**:
   - –°—Ç–∞—Ç—É—Å `payment_marked`.
   - Bank Holder –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
3. Bank Holder –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É:
   - –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Üí `active`.
4. –ï—Å–ª–∏ Bank Holder –æ—Ç–º–µ—á–∞–µ—Ç –æ–ø–ª–∞—Ç—É —Å–∞–º ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
5. –ö–æ–≥–¥–∞ **–≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö `onboarding|pending_payment|payment_marked`**, —á–µ–ª–ª–µ–Ω–¥–∂ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è:
   - `started_at = now`, `ends_at = now + duration`.
   - –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ–∫–Ω–∞ —á–µ–∫‚Äë–∏–Ω–æ–≤.

---

## 11. –ß–µ–∫‚Äë–∏–Ω—ã

### 11.1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫–æ–Ω
- –û–∫–Ω–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ —á–µ–ª–ª–µ–Ω–¥–∂–∞ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
- –ü–µ—Ä–≤—ã–π —á–µ–∫‚Äë–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `checkinPeriod` –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞.
- –ü–µ—Ä–∏–æ–¥:
  - `checkinPeriodMinutes` (–µ—Å–ª–∏ > 0)
  - –∏–Ω–∞—á–µ `checkinPeriodDays` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14 –¥–Ω–µ–π).
- –ö–∞–∂–¥–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ 48 —á–∞—Å–æ–≤ (`checkinWindowHours`).

### 11.2. –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:
1. –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–∫–Ω–∞ –Ω–∞ `open`.
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É:
   - ¬´–û—Ç–∫—Ä—ã—Ç–æ –æ–∫–Ω–æ —á–µ–∫‚Äë–∏–Ω–∞ #N¬ª
   - –∫–Ω–æ–ø–∫–∞ **¬´üìã –°–¥–∞—Ç—å —á–µ–∫-–∏–Ω¬ª**.
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.

### 11.3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
–ó–∞ 12 —á–∞—Å–æ–≤ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è:
- –í –≥—Ä—É–ø–ø—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ç–µ—Ö, –∫—Ç–æ –µ—â—ë –Ω–µ —Å–¥–∞–ª.
- –ö–∞–∂–¥–æ–º—É –∏–∑ –Ω–∏—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ª–∏—á–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.

### 11.4. –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
- –°—Ç–∞—Ç—É—Å –æ–∫–Ω–∞ ‚Üí `closed`.
- –£—á–∞—Å—Ç–Ω–∏–∫–∏, –Ω–µ —Å–¥–∞–≤—à–∏–µ —á–µ–∫‚Äë–∏–Ω, –ø–æ–ª—É—á–∞—é—Ç:
  - `total_checkins +1`
  - `skipped_checkins +1`
- –ï—Å–ª–∏ `skipped_checkins > max_skips`, —É—á–∞—Å—Ç–Ω–∏–∫ –¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è.
- –í –≥—Ä—É–ø–ø—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏—Ç–æ–≥: –∫—Ç–æ —Å–¥–∞–ª, –∫—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª.

### 11.5. –ü—Ä–æ—Ü–µ—Å—Å —Å–¥–∞—á–∏ —á–µ–∫‚Äë–∏–Ω–∞ (–ª–∏—á–∫–∞)
1. **–í–µ—Å** (30‚Äì150).
2. **–¢–∞–ª–∏—è** (40‚Äì150).
3. **–§–æ—Ç–æ 1/4** (–∞–Ω—Ñ–∞—Å).
4. **–§–æ—Ç–æ 2/4** (–ø—Ä–æ—Ñ–∏–ª—å —Å–ª–µ–≤–∞).
5. **–§–æ—Ç–æ 3/4** (–ø—Ä–æ—Ñ–∏–ª—å —Å–ø—Ä–∞–≤–∞).
6. **–§–æ—Ç–æ 4/4** (—Å–æ —Å–ø–∏–Ω—ã).

–ü–æ—Å–ª–µ —Å–¥–∞—á–∏:
- –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å —á–µ–∫‚Äë–∏–Ω–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–æ –æ–∫–Ω—É).
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (`completed_checkins +1`, `total_checkins +1`).
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.

### 11.6. LLM‚Äë—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —á–µ–∫‚Äë–∏–Ω—É
–ï—Å–ª–∏ `OPENROUTER_API_KEY` –∑–∞–¥–∞–Ω:
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–µ–∫—É—â–∏–µ —Ñ–æ—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ (`data/photos/{participantId}/checkin-{N}`)
- –§–æ—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ base64 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ LLM (–º–æ–¥–µ–ª—å `google/gemini-3-flash-preview`). –¢–∞–∫–∂–µ –ø—Ä–æ–º–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–µ–∫–∏–Ω–æ–≤, —á—Ç–æ–±—ã LLM –º–æ–≥–ª–∞ –æ—Ü–µ–Ω–∏—Ç—å –¥–∏–Ω–∞–º–∏–∫—É –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞.
- LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  - –ü—Ä–æ–≥—Ä–µ—Å—Å
  - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - –ü–∏—Ç–∞–Ω–∏–µ
  - –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
  - –ú–æ—Ç–∏–≤–∞—Ü–∏—è
  - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `checkin_recommendations`.

–ï—Å–ª–∏ LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

---

## 12. –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç

### 12.1. –£—Å–ª–æ–≤–∏—è –∑–∞–ø—É—Å–∫–∞
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏.
- –ï—Å–ª–∏ `ends_at <= now`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª.

### 12.2. –†–∞—Å—á—ë—Ç –æ—á–∫–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:
- –ê–∫—Ç–∏–≤–Ω—ã–µ/–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏.
- –¢–∞–∫–∂–µ **–¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/–≤—ã–±—ã–≤—à–∏–µ**, –µ—Å–ª–∏ –∏—Ö –æ–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –ø—É–ª –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö).

**–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏ (goalAchievement):**
- `–°–±—Ä–æ—Å–∏—Ç—å`:
  - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤–µ—Å—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–ª–∏
  - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–∞–ª–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–ª–∏
  - –∏—Ç–æ–≥ = 70% –≤–µ—Å–∞ + 30% —Ç–∞–ª–∏–∏
- `–ù–∞–±—Ä–∞—Ç—å`:
  - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤–µ—Å—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–ª–∏
  - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–∞–ª–∏–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (—Å—Ç–∞–≤–∏—Ç—Å—è 100%)
  - –∏—Ç–æ–≥ = 70% –≤–µ—Å–∞ + 30% (100%)

**–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ (disciplineScore):**
- `completed_checkins / total_checkins * 100`
- –ï—Å–ª–∏ —á–µ–∫‚Äë–∏–Ω–æ–≤ –Ω–µ—Ç ‚Äî –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ = 100.

**–ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª:**
- `totalScore = 0.7 * goalAchievement + 0.3 * disciplineScore`

### 12.3. –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏
–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ:
- –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `active` –∏–ª–∏ `completed`
- `disciplineScore >= disciplineThreshold * 100`
- `goalAchievement >= 100`

### 12.4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–Ω–∫–∞ (–∫–∞–∫ –≤ –∫–æ–¥–µ)
- –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –∏ –µ—Å—Ç—å –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ:
  - **–ø—É–ª = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö √ó —Å—Ç–∞–≤–∫–∞**
  - **–∫–∞–∂–¥—ã–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–≤–Ω—É—é –¥–æ–ª—é**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±–∞–ª–ª–∞
- –ï—Å–ª–∏ –≤—Å–µ –ø–æ–±–µ–¥–∏–ª–∏ ‚Äî –≤—Å–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–≤–æ—è —Å—Ç–∞–≤–∫–∞.
- –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π ‚Äî –≤—Å–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞–≤–∫–∞.


### 12.5. –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í –≥—Ä—É–ø–ø—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥.
- –ö–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É ‚Äî –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

---

## 13. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ç–∞–π–º–∑–æ–Ω–æ–π `Europe/Moscow`:
- –ï—Å–ª–∏ `checkinPeriodMinutes < 60` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É.
- –ò–Ω–∞—á–µ ‚Äî –∫–∞–∂–¥—ã–π —á–∞—Å.

–ó–∞–¥–∞—á–∏:
- `open-checkin` ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–∞.
- `reminder` ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.
- `close-checkin` ‚Äî –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–∞.
- `finale` ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç.
- `bankholder-election` ‚Äî –∑–∞–∫—Ä—ã—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∞–π–º–∞—É—Ç—É.
- `onboarding-timeout` ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –Ω–µ –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥.

–¢–∞–∫–∂–µ –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥).

---

## 14. –û—à–∏–±–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ï—Å—Ç—å middleware‚Äë–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —á–∞—Ç: ¬´–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞‚Ä¶¬ª.
- Sentry –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –∑–∞–¥–∞–Ω `SENTRY_DSN`.

---

## 15. –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ–∫‚Äë–∏–Ω–æ–≤ –∏ —Å—Ç–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ:
```
./data/photos/{participantId}/start/{front|left|right|back}.jpg
./data/photos/{participantId}/checkin-{N}/{front|left|right|back}.jpg
```

---

## 16. –ó–∞–º–µ—á–∞–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –°–µ—Å—Å–∏–∏ (`grammy` session) —Ö—Ä–∞–Ω–∏—Ç—å –≤ sqlite —á—Ç–æ–±—ã –±—ã–ª–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.
- –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –æ—Ç—á–µ—Ç–∞–º–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —á–µ–ª–µ–Ω–¥–∂—É –≤ –ª–∏—á–∫–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—á—Ç–µ–Ω—ã –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞: —á—Ç–æ–±—ã —Ñ–æ—Ç–æ, —á–µ–∫–∏–Ω—ã, —á–µ–ª–µ–Ω–¥–∂—ã –Ω–µ –ø—Ä–æ–ª–∏–≤–∞–ª–∏—Å—å –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## 17. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —ç–∫—Ä–∞–Ω–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –Ω—É–ª—è)

–ü—Ä–∏ –≤–æ—Å—Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ:
- –ö–æ–º–∞–Ω–¥—ã `/start`, `/create`, `/bankholder`, `/status`, `/help`, `/clear_db`.
- Inline‚Äë–∫–Ω–æ–ø–∫–∏: join, paid, confirm, vote, checkin, clear_db_yes/no.
- –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞, –æ–ø–ª–∞—Ç—ã, —á–µ–∫‚Äë–∏–Ω–∞, —Ñ–∏–Ω–∞–ª–∞ –∏ —Ä–∞—Å—Å—ã–ª–æ–∫.


## Tech Stack

- **Runtime:** Node.js
- **Language:** TypeScript (ES2022 target, strict mode)
- **Bot Framework:** grammY (Telegram bot framework)
  - Session Plugin for state management
  - Conversations Plugin for multi-step dialogs (uses replay engine)
- **Database:** SQLite with Drizzle ORM v0.29.3 
- **LLM Integration:** OpenRouter API
  - Model: `google/gemini-3-flash-preview` (multimodal vision)
  - Goal validation, recommendations, and check-in analysis
- **Monitoring:** Sentry for error tracking
- **Automation:** Cron scheduler (hourly jobs for check-in windows, reminders, finals)
- **Media Storage:** local storage (native)
- **DevOps:** Docker, GitHub Actions CI/CD
- **Hosting:** VPS with Coolify


 ## Tests
 –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏. –°–Ω–∞—á–∞–ª–∞ –ø–∏—à–∏ —Ç–µ—Å—Ç, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥ –Ω–µ–≥–æ –ª–æ–≥–∏–∫—É.

 ## Language

Product documentation is in Russian. Technical documentation should be in Russian.
